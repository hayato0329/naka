<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé§ Èü≥Â£∞Ë™çË≠ò„Ç¢„Éó„É™ÔºàÂ≠¶ÁøíÊ©üËÉΩ‰ªò„ÅçÔºâ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        /* Êäò„Çä„Åü„Åü„Åø„Çª„ÇØ„Ç∑„Éß„É≥ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
        .collapsible-section {
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .collapsible-header {
            padding: 15px 20px;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .collapsible-header:hover {
            filter: brightness(95%);
        }

        .collapsible-arrow {
            font-size: 14px;
            transition: transform 0.2s ease;
        }

        .collapsible-content {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            max-height: 0;
        }

        .collapsible-content.expanded {
            max-height: 1000px; /* ÂçÅÂàÜ„Å™È´ò„Åï„Å´Ë®≠ÂÆö */
        }

        .collapsible-inner {
            padding: 20px;
        }

        /* ÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥ÂÄãÂà•„Ç´„É©„Éº */
        .debug-section .collapsible-header {
            background: #212529;
            color: #28a745;
        }

        .debug-section .collapsible-inner {
            background: #212529;
        }

        .status-section .collapsible-header {
            background: #f8f9fa;
            color: #007bff;
            border-left: 4px solid #007bff;
        }

        .status-section .collapsible-inner {
            background: #f8f9fa;
        }

        .api-section .collapsible-header {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .api-section .collapsible-inner {
            background: #fff3cd;
        }

        .template-section .collapsible-header {
            background: #e6f3ff;
            color: #0056b3;
            border-left: 4px solid #0056b3;
        }

        .template-section .collapsible-inner {
            background: #e6f3ff;
        }

        .prompt-section .collapsible-header {
            background: #e8f5e8;
            color: #1e7e34;
            border-left: 4px solid #28a745;
        }

        .prompt-section .collapsible-inner {
            background: #e8f5e8;
        }

        .learning-section .collapsible-header {
            background: #f0e6ff;
            color: #6f42c1;
            border-left: 4px solid #6f42c1;
        }

        .learning-section .collapsible-inner {
            background: #f0e6ff;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
        }
        
        .status-value {
            font-weight: bold;
            padding: 3px 10px;
            border-radius: 15px;
            background: #e9ecef;
            color: #495057;
        }
        
        .status-value.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-value.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* „É°„Ç§„É≥„Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥„ÅÆÊñ∞„Åó„ÅÑÈÖçÁΩÆ */
        .main-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary { background: #007bff; }
        .btn-danger { background: #dc3545; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-info { background: #17a2b8; }
        .btn-secondary { background: #6c757d; }
        .btn-purple { background: #6f42c1; }

        /* „Éó„É≠„É≥„Éó„ÉàÁ∑®ÈõÜÁî®„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢ */
        .prompt-textarea {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: both;
            box-sizing: border-box;
            margin-bottom: 15px;
        }

        .prompt-textarea:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
            outline: none;
        }

        /* „ÉÜ„É≥„Éó„É¨„Éº„ÉàÁÆ°ÁêÜ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .template-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .template-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .template-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .template-input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
        }

        .file-input {
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background: white;
            width: 100%;
            box-sizing: border-box;
        }

        /* Èü≥Â£∞Ë™çË≠òÁµêÊûú„Ç®„É™„Ç¢ */
        .transcript-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .transcript-main {
            flex: 1;
        }
        
        .transcript-area {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: relative;
            user-select: text;
        }
        
        .transcript-area.listening {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }
        
        .transcript-area.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-style: italic;
            font-family: Arial, sans-serif;
        }

        .transcript-textarea {
            width: 100%;
            min-height: 200px;
            max-height: 400px;
            padding: 20px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            box-sizing: border-box;
        }

        .transcript-textarea.listening {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .debug-log {
            color: #28a745;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
            line-height: 1.4;
        }

        /* Áµ±Ë®àÊÉÖÂ†± */
        .stats-section {
            background: #fff3cd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .stats-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        /* Á∑®ÈõÜ„Éú„Çø„É≥ */
        .edit-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .edit-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .edit-btn.toggle {
            background: #17a2b8;
            color: white;
        }

        .edit-btn.toggle:hover {
            background: #138496;
        }

        /* Â≠¶Áøí„Éá„Éº„ÇøÁÆ°ÁêÜ */
        .learning-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .learning-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #6f42c1;
        }

        .learning-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .learning-item .correction-text {
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .learning-item .original {
            color: #dc3545;
        }

        .learning-item .corrected {
            color: #28a745;
        }

        .learning-item .actions {
            display: flex;
            gap: 5px;
        }

        .learning-item .btn-small {
            padding: 3px 8px;
            font-size: 11px;
            border-radius: 3px;
        }

        .correction-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .correction-input-group input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        .auto-correction-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .auto-correction-toggle input[type="checkbox"] {
            transform: scale(1.2);
        }

        /* Ë™çË®ºÁîªÈù¢ */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 20000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .auth-modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }

        .auth-title {
            color: #333;
            font-size: 24px;
            margin-bottom: 20px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .auth-input {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
        }

        .auth-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
            outline: none;
        }

        .auth-btn {
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .auth-btn:hover {
            background: #0056b3;
        }

        .auth-error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 10px;
        }

        .main-content {
            display: none;
        }

        .main-content.authenticated {
            display: block;
        }

        /* ÈÄöÁü• */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 10001;
            font-size: 12px;
            max-width: 300px;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Ë¶ÅÁ¥Ñ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆ„Çπ„Çø„Ç§„É´ÔºàËøΩÂä†Ê©üËÉΩ1ÔºöÈ†ÖÁõÆÂà•„Ç≥„Éî„ÉºÂØæÂøúÔºâ */
        .summary-popup {
            position: fixed;
            top: 50px;
            right: 50px;
            width: 450px;
            max-height: 680px; /* 600px„Åã„ÇâÂ§âÊõ¥ */
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            display: none;
            overflow: hidden;
        }

        .summary-header {
            background: #007bff;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-title {
            font-weight: bold;
            font-size: 16px;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .summary-content {
            padding: 20px;
            max-height: 530px; /* 450px„Åã„ÇâÂ§âÊõ¥ */
            overflow-y: auto;
            line-height: 1.6;
        }

        .summary-content h2 {
            color: #007bff;
            font-size: 18px;
            margin: 15px 0 10px 0;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
            cursor: pointer;
        }

        .summary-content h2:hover {
            background: rgba(0, 123, 255, 0.1);
            padding: 5px;
            border-radius: 5px;
        }

        .summary-content h3 {
            color: #28a745;
            font-size: 16px;
            margin: 10px 0 5px 0;
            cursor: pointer;
        }

        .summary-content h3:hover {
            background: rgba(40, 167, 69, 0.1);
            padding: 3px;
            border-radius: 3px;
        }

        .summary-section {
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            margin: 5px 0;
        }

        .summary-section:hover {
            background: rgba(0, 123, 255, 0.05);
        }

        .summary-actions {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        .summary-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .summary-btn.copy {
            background: #28a745;
            color: white;
        }

        .summary-btn.print {
            background: #6c757d;
            color: white;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            .transcript-container {
                flex-direction: column;
            }
            
            .summary-popup {
                top: 20px;
                right: 20px;
                left: 20px;
                width: auto;
                max-height: 70vh;
            }
        }
    </style>
</head>
<body>
    <!-- Ë™çË®ºÁîªÈù¢ -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <h2 class="auth-title">üîê Èü≥Â£∞Ë™çË≠ò„Ç¢„Éó„É™</h2>
            <p>„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Å´„ÅØË™çË®º„ÅåÂøÖË¶Å„Åß„Åô</p>
            <form class="auth-form" id="authForm">
                <input type="text" class="auth-input" id="username" placeholder="„É¶„Éº„Ç∂„ÉºÂêç" required>
                <input type="password" class="auth-input" id="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ" required>
                <button type="submit" class="auth-btn">üîì „É≠„Ç∞„Ç§„É≥</button>
            </form>
            <div class="auth-error" id="authError" style="display: none;"></div>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="main-content" id="mainContent">
    <div class="container">
        <div class="header">
            <h1>üé§ Èü≥Â£∞Ë™çË≠ò„Ç¢„Éó„É™ÔºàÂ≠¶ÁøíÊ©üËÉΩ‰ªò„ÅçÔºâ</h1>
            <p>Ë©¶È®ìÊ•≠Áïå„Çµ„Éù„Éº„ÉàÂØæÂøúË®òÈå≤„Ç∑„Çπ„ÉÜ„É†Ôºö<strong style="color:red;">„Éí„Ç¢„É™„É≥„Ç∞ÊÉÖÂ†±„ÅØË™§Ë™çÈò≤Ê≠¢„ÅÆ„Åü„ÇÅÂøÖ„ÅöÂæ©Âî±ÔºÅÔºÅ</strong></p>
            <p>‚òÖÂæ©Âî±ÂøÖÈ†àÊÉÖÂ†±Ôºö<strong style="color:red;">„Äê„ÅäÈõªË©±Âè£„ÅÆÁ´ãÂ†¥„ÄÅË©¶È®ìÂêçÔºàÁ¥ö„Åæ„ÅßÂæ©Âî±Ôºâ„ÄÅÂïèÂêà„ÅõË¶Å‰ª∂„ÄÅÊ∞èÂêçÁîüÂπ¥ÊúàÊó•„Äë</strong>‚òÖ</p>
            <p>Ê≥®ÊÑèÔºö<strong style="color:blue;">Ê°àÂÜÖ‰∏≠„ÅØ„ÄÅÊ≠£Âºè„Å™Ë©¶È®ìÂêçÁß∞„Çí‰Ωø„ÅÜ„ÄÇ</strong></p>
            <p>Ë©¶È®ì„ÉªÊ§úÂÆöÊ•≠ÁïåÁâπÂåñÂûãÂ≠¶Áøí„Ç∑„Çπ„ÉÜ„É† | „Éû„Éã„É•„Ç¢„É´„ÅØ<a href="https://hayato0329.github.io/study/about5.html" target="_blank"><strong style="color:blue;">„Åì„Å°„Çâ</strong></a>„Çí„ÇØ„É™„ÉÉ„ÇØ</p>
        </div>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥„ÅÆÊñ∞„Åó„ÅÑÈÖçÁΩÆ -->
        <div class="main-controls">
            <button class="btn btn-primary" id="startBtn">üéôÔ∏è Èå≤Èü≥ÈñãÂßã</button>
            <button class="btn btn-danger" id="stopBtn" disabled>‚èπÔ∏è Èå≤Èü≥ÂÅúÊ≠¢</button>
            <button class="btn btn-success" id="summaryBtn" disabled>ü§ñ ÂØæÂøúË®òÈå≤Ë¶ÅÁ¥Ñ</button>
            <button class="btn btn-secondary" id="endBtn" disabled>üîö ÁµÇ‰∫Ü</button>
        </div>

        <!-- Èü≥Â£∞Ë™çË≠òÁµêÊûú„Ç®„É™„Ç¢„ÅÆ‰∏ä„ÅÆÁ∑®ÈõÜ„É¢„Éº„Éâ -->
        <div class="edit-controls">
            <button class="edit-btn toggle" id="editToggleBtn" onclick="toggleEditMode()">‚úèÔ∏è Á∑®ÈõÜ„É¢„Éº„Éâ</button>
        </div>

        <!-- Èü≥Â£∞Ë™çË≠òÁµêÊûú -->
        <div class="transcript-container">
            <div class="transcript-main">
                <div class="transcript-area empty" id="transcriptArea" style="display: block;">
                    Èü≥Â£∞Ë™çË≠òÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...
                </div>
                
                <textarea class="transcript-textarea" id="transcriptTextarea" placeholder="Èü≥Â£∞Ë™çË≠òÁµêÊûú„ÇíÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô..." style="display: none;"></textarea>
            </div>
        </div>

        <!-- „Åù„ÅÆ‰ªñ„ÅÆ„Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥ -->
        <div class="controls">
            <button class="btn btn-success" id="downloadBtn" disabled>üíæ „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
            <button class="btn btn-warning" id="apiBtn">üîë APIË®≠ÂÆö</button>
            <button class="btn btn-primary" id="testBtn" disabled>üîß Êé•Á∂ö„ÉÜ„Çπ„Éà</button>
            <button class="btn btn-purple" id="quickLearnBtn" disabled>üß† „ÇØ„Ç§„ÉÉ„ÇØÂ≠¶Áøí</button>
        </div>

        <!-- „Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞ -->
        <div class="collapsible-section debug-section">
            <div class="collapsible-header" onclick="toggleSection('debugSection')">
                <span>üíª „Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞</span>
                <span class="collapsible-arrow" id="debugArrow">‚ñº</span>
            </div>
            <div class="collapsible-content collapsed" id="debugContent">
                <div class="collapsible-inner">
                    <div class="debug-log" id="debugLog">
                        „Ç¢„Éó„É™ÂàùÊúüÂåñ‰∏≠...
                    </div>
                </div>
            </div>
        </div>

        <!-- „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖã -->
        <div class="collapsible-section status-section">
            <div class="collapsible-header" onclick="toggleSection('statusSection')">
                <span>üìä „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖã</span>
                <span class="collapsible-arrow" id="statusArrow">‚ñº</span>
            </div>
            <div class="collapsible-content collapsed" id="statusContent">
                <div class="collapsible-inner">
                    <div class="status-item">
                        <span>HTTPSÁí∞Â¢É:</span>
                        <span class="status-value" id="httpsStatus">Á¢∫Ë™ç‰∏≠</span>
                    </div>
                    <div class="status-item">
                        <span>Èü≥Â£∞Ë™çË≠òAPI:</span>
                        <span class="status-value" id="speechStatus">Á¢∫Ë™ç‰∏≠</span>
                    </div>
                    <div class="status-item">
                        <span>„Éû„Ç§„ÇØ„Ç¢„ÇØ„Çª„Çπ:</span>
                        <span class="status-value" id="micStatus">Êú™Á¢∫Ë™ç</span>
                    </div>
                    <div class="status-item">
                        <span>Gemini API:</span>
                        <span class="status-value" id="apiStatus">Êú™Ë®≠ÂÆö</span>
                    </div>
                    <div class="status-item">
                        <span>Â≠¶ÁøíÊ©üËÉΩ:</span>
                        <span class="status-value success" id="learningStatus">Ê∫ñÂÇôÂÆå‰∫Ü</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gemini APIË®≠ÂÆö -->
        <div class="collapsible-section api-section">
            <div class="collapsible-header" onclick="toggleSection('apiSection')">
                <span>üîë Gemini APIË®≠ÂÆö</span>
                <span class="collapsible-arrow" id="apiArrow">‚ñº</span>
            </div>
            <div class="collapsible-content collapsed" id="apiContent">
                <div class="collapsible-inner">
                    <p><strong>ÂØæÂøúË®òÈå≤Ë¶ÅÁ¥ÑÊ©üËÉΩ„Çí‰ΩøÁî®„Åô„ÇãÂ†¥Âêà„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</strong></p>
                    <p>ÂèñÂæóÊñπÊ≥ï: <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> ‚Üí Create API key</p>
                </div>
            </div>
        </div>

        <!-- „ÉÜ„É≥„Éó„É¨„Éº„ÉàÁÆ°ÁêÜ -->
        <div class="collapsible-section template-section">
            <div class="collapsible-header" onclick="toggleSection('templateSection')">
                <span>üìÑ „ÉÜ„É≥„Éó„É¨„Éº„ÉàÁÆ°ÁêÜ</span>
                <span class="collapsible-arrow" id="templateArrow">‚ñº</span>
            </div>
            <div class="collapsible-content collapsed" id="templateContent">
                <div class="collapsible-inner">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">„ÉÜ„É≥„Éó„É¨„Éº„ÉàÈÅ∏Êäû:</label>
                        <select id="templateSelect" class="template-input" onchange="onTemplateSelectChange()">
                            <option value="">„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÈÅ∏Êäû...</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;" id="templateNameLabel">Êñ∞Ë¶è„ÉÜ„É≥„Éó„É¨„Éº„ÉàÂêç:</label>
                        <input type="text" id="newTemplateName" class="template-input" placeholder="„ÉÜ„É≥„Éó„É¨„Éº„ÉàÂêç„ÇíÂÖ•Âäõ">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">„ÉÜ„É≥„Éó„É¨„Éº„ÉàÂÜÖÂÆπ:</label>
                        <textarea id="templateContentTextarea" class="prompt-textarea" placeholder="„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
                    </div>
                    
                    <div class="template-controls">
                        <button class="template-btn btn-success" onclick="saveTemplate()">üíæ ‰øùÂ≠ò</button>
                        <button class="template-btn btn-danger" onclick="deleteTemplate()">üóëÔ∏è ÂâäÈô§</button>
                        <button class="template-btn btn-info" onclick="editTemplate()">‚úèÔ∏è Á∑®ÈõÜ</button>
                        <button class="template-btn btn-warning" onclick="loadTemplate()">üìã Ë™≠Ëæº</button>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">„Éï„Ç°„Ç§„É´„Åã„Çâ„Ç§„É≥„Éù„Éº„Éà:</label>
                        <input type="file" id="templateFile" class="file-input" accept=".txt,.doc,.docx" onchange="importTemplate(event)">
                    </div>
                </div>
            </div>
        </div>

        <!-- „Éó„É≠„É≥„Éó„ÉàË®≠ÂÆö -->
        <div class="collapsible-section prompt-section">
            <div class="collapsible-header" onclick="toggleSection('promptSection')">
                <span>üìù „Éó„É≠„É≥„Éó„ÉàË®≠ÂÆö</span>
                <span class="collapsible-arrow" id="promptArrow">‚ñº</span>
            </div>
            <div class="collapsible-content collapsed" id="promptContent">
                <div class="collapsible-inner">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">ÁèæÂú®„ÅÆ„Éó„É≠„É≥„Éó„Éà:</label>
                        <select id="promptSelect" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
                            <option value="default">„Éá„Éï„Ç©„É´„ÉàÔºàË©¶È®ìÊ•≠ÁïåÁâπÂåñË¶ÅÁ¥ÑÔºâ</option>
                            <option value="support">„Ç´„Çπ„Çø„Éû„Éº„Çµ„Éù„Éº„ÉàÁî®</option>
                            <option value="custom">„Ç´„Çπ„Çø„É†</option>
                        </select>
                    </div>
                    <div id="promptPreview" style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-size: 12px; max-height: 100px; overflow-y: auto; margin-bottom: 10px;">
                        Ë©¶È®ìÊ•≠ÁïåÁâπÂåñ„ÅÆ„Éá„Éï„Ç©„É´„ÉàË¶ÅÁ¥Ñ„Éó„É≠„É≥„Éó„Éà„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åô
                    </div>
                    <button class="btn btn-success" style="width: 100%; margin-bottom: 10px;" onclick="editPrompt()">‚úèÔ∏è „Éó„É≠„É≥„Éó„ÉàÁ∑®ÈõÜ</button>
                </div>
            </div>
        </div>

        <!-- „ÉÜ„Ç≠„Çπ„ÉàÂ≠¶Áøí„ÉªËá™Âãï‰øÆÊ≠£ -->
        <div class="collapsible-section learning-section">
            <div class="collapsible-header" onclick="toggleSection('learningSection')">
                <span>üß† „ÉÜ„Ç≠„Çπ„ÉàÂ≠¶Áøí„ÉªËá™Âãï‰øÆÊ≠£</span>
                <span class="collapsible-arrow" id="learningArrow">‚ñº</span>
            </div>
            <div class="collapsible-content collapsed" id="learningContent">
                <div class="collapsible-inner">
                    <!-- Ëá™Âãï‰øÆÊ≠£Ë®≠ÂÆö -->
                    <div class="auto-correction-toggle">
                        <input type="checkbox" id="autoCorrection" checked>
                        <label for="autoCorrection">üîÑ „É™„Ç¢„É´„Çø„Ç§„É†Ëá™Âãï‰øÆÊ≠£„ÇíÊúâÂäπ„Å´„Åô„Çã</label>
                    </div>

                    <!-- Â≠¶ÁøíÁµ±Ë®à -->
                    <div class="learning-stats">
                        <h4>üìä Â≠¶Áøí„Éá„Éº„ÇøÁµ±Ë®à</h4>
                        <div class="status-item">
                            <span>Â≠¶ÁøíÊ∏à„Åø‰øÆÊ≠£„Éë„Çø„Éº„É≥:</span>
                            <span class="status-value" id="learningCount">0‰ª∂</span>
                        </div>
                        <div class="status-item">
                            <span>‰ªäÂõû„Çª„ÉÉ„Ç∑„Éß„É≥„Åß„ÅÆ‰øÆÊ≠£:</span>
                            <span class="status-value" id="sessionCorrectionCount">0‰ª∂</span>
                        </div>
                        <div class="status-item">
                            <span>Ëá™Âãï‰øÆÊ≠£ÂÆüË°åÂõûÊï∞:</span>
                            <span class="status-value" id="autoCorrectionCount">0‰ª∂</span>
                        </div>
                    </div>

                    <!-- ÊâãÂãï‰øÆÊ≠£„Éë„Çø„Éº„É≥ËøΩÂä† -->
                    <div style="margin-bottom: 15px;">
                        <h4>‚ûï ‰øÆÊ≠£„Éë„Çø„Éº„É≥„ÇíÊâãÂãïËøΩÂä†</h4>
                        <div class="correction-input-group">
                            <input type="text" id="originalText" placeholder="Èü≥Â£∞Ë™çË≠ò„Åï„Çå„ÇãË™§„Å£„ÅüÊñáÂ≠ó" autocomplete="off">
                            <input type="text" id="correctedText" placeholder="Ê≠£„Åó„ÅÑÊñáÂ≠ó" autocomplete="off">
                            <button class="btn btn-success" onclick="addLearningData()">ËøΩÂä†</button>
                        </div>
                    </div>

                    <!-- Â≠¶Áøí„Éá„Éº„ÇøÁÆ°ÁêÜ -->
                    <div class="learning-controls">
                        <button class="btn btn-info" onclick="showLearningData()">üìã Â≠¶Áøí„Éá„Éº„ÇøË°®Á§∫</button>
                        <button class="btn btn-success" onclick="exportLearningData()">üì§ „Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                        <button class="btn btn-warning" onclick="importLearningDataDialog()">üì• „Ç§„É≥„Éù„Éº„Éà</button>
                        <button class="btn btn-danger" onclick="clearLearningData()">üóëÔ∏è ÂÖ®ÂâäÈô§</button>
                    </div>

                    <!-- Â≠¶Áøí„Éá„Éº„ÇøË°®Á§∫„Ç®„É™„Ç¢ -->
                    <div id="learningDataDisplay" style="max-height: 200px; overflow-y: auto; margin-top: 15px; display: none;">
                        <!-- Â≠¶Áøí„Éá„Éº„Çø„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>

                    <!-- „Éï„Ç°„Ç§„É´„Ç§„É≥„Éù„Éº„ÉàÁî®ÔºàÈùûË°®Á§∫Ôºâ -->
                    <input type="file" id="learningFileInput" accept=".json,.csv,.txt" style="display: none;" onchange="importLearningData(event)">
                </div>
            </div>
        </div>

        <!-- ÈÄöË©±Áµ±Ë®àÔºàÂ∏∏ÊôÇË°®Á§∫Ôºâ -->
        <div class="stats-section">
            <h3>üìä ÈÄöË©±Áµ±Ë®à</h3>
            <div class="status-item">
                <span>ÈÄöË©±Êï∞ÔºàÈå≤Èü≥ÈñãÂßãÂõûÊï∞Ôºâ:</span>
                <span class="status-value" id="callCount">0Âõû</span>
            </div>
            <div class="status-item">
                <span>ÁèæÂú®„ÅÆÈÄöË©±ÊôÇÈñì:</span>
                <span class="status-value" id="currentDuration">00:00</span>
            </div>
            <div class="status-item">
                <span>Á¥ØË®àÈÄöË©±ÊôÇÈñì:</span>
                <span class="status-value" id="totalDuration">00:00</span>
            </div>
            <div class="status-item">
                <span>Âπ≥ÂùáÈÄöË©±ÊôÇÈñì:</span>
                <span class="status-value" id="avgDuration">00:00</span>
            </div>
        </div>
    </div>

    <!-- Ë¶ÅÁ¥Ñ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÔºàËøΩÂä†Ê©üËÉΩ1ÔºöÈ†ÖÁõÆÂà•„Ç≥„Éî„ÉºÂØæÂøúÔºâ -->
    <div class="summary-popup" id="summaryPopup">
        <div class="summary-header">
            <div class="summary-title" id="summaryPopupTitle">ü§ñ ÂØæÂøúË®òÈå≤Ë¶ÅÁ¥ÑÁµêÊûú</div>
            <button class="close-btn" onclick="closeSummaryPopup()">√ó</button>
        </div>
        <div class="summary-content" id="summaryContent">
            Ë¶ÅÁ¥ÑÂÜÖÂÆπ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...
        </div>
        <div class="summary-actions">
            <button class="summary-btn copy" onclick="copySummary()">ÔøΩ ÂÖ®‰Ωì„Ç≥„Éî„Éº</button>
            <button class="summary-btn print" onclick="printSummary()">üñ®Ô∏è Âç∞Âà∑</button>
        </div>
    </div>
    </div>
    
    <script>
        // === „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞ ===
        let recognition = null;
        let isRecording = false;
        let transcript = '';
        let transcriptHTML = ''; // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊîπÂñÑÁî®
        let apiKey = '';
        let isEditMode = false;
        let isAuthenticated = false;
        
        let callCount = 0;
        let currentCallStart = null;
        let currentCallDuration = 0;
        let totalDuration = 0;
        let callTimer = null;
        
        let learningData = {};
        let learningDataRegex = null; // Ëá™Âãï‰øÆÊ≠£„ÇíÈ´òÈÄüÂåñ„Åô„Çã„Åü„ÇÅ„ÅÆÊ≠£Ë¶èË°®Áèæ
        let learningDataMap = new Map(); // Ëá™Âãï‰øÆÊ≠£„ÇíÈ´òÈÄüÂåñ„Åô„Çã„Åü„ÇÅ„ÅÆ„Éû„ÉÉ„Éó
        let sessionCorrectionCount = 0;
        let autoCorrectionCount = 0;
        
        let currentSummary = '';
        let summaryData = {};
        let saveDirectory = null; 
        
        const AUTH_CONFIG = {
            username: 'cbts-sol',
            password: 'cbts1192'
        };
        
        let templates = {};
        
        let currentPrompt = 'default';
        const prompts = {
            default:`„ÅÇ„Å™„Åü„ÅØË©¶È®ìÊ•≠Áïå„Çµ„Éù„Éº„Éà„Çª„É≥„Çø„Éº„ÅÆÂ∞ÇÈñÄ„Çπ„Çø„ÉÉ„Éï„Åß„Åô„ÄÇ‰ª•‰∏ã„ÅÆÊù°‰ª∂„Å®Âá∫ÂäõÂΩ¢Âºè„Å´Ê≤ø„Å£„Å¶„ÄÅÂØæÂøúË®òÈå≤Áî®„ÅÆË¶ÅÁ¥Ñ„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

### ËÉåÊôØ
„ÉªÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà„ÅØË©¶È®ì„ÉªÊ§úÂÆö„ÉªË≥áÊ†º„Å´Èñ¢„Åô„Çã„Ç´„Çπ„Çø„Éû„Çµ„Éù„Éº„Éà„ÅÆ„É™„Ç¢„É´„Çø„Ç§„É†ÊñáÂ≠ó„ÅäË∂ä„Åó„ÅÆÁµêÊûú„Åß„Åô
„Éª„ÇØ„É©„Ç§„Ç¢„É≥„ÉàÊèêÂá∫Áî®„ÅÆÂØæÂøúË®òÈå≤„Å®„Åó„Å¶‰ΩøÁî®„Åó„Åæ„Åô
„ÉªÂØæÂøúËÄÖ„ÅÆÁô∫Ë®Ä„ÅÆ„Åø„ÅåË®òÈå≤„Åï„Çå„Å¶„Åä„Çä„ÄÅÈ°ßÂÆ¢„ÅÆÁô∫Ë®Ä„ÅØÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
„ÉªÂïèÂêà„ÅõÂÜÖÂÆπ„ÅØ„ÄÅÂøÖ„ÅöÂæ©Âî±„Åó„Åæ„Åô„ÄÇ

### Êù°‰ª∂
1. Ë™§Â≠óËÑ±Â≠ó„ÄÅÈü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº‰øÆÊ≠£„ÄÅËá™ÁÑ∂„Å™Êó•Êú¨Ë™ûË°®Áèæ
2. Ë≥™ÂïèÂÜÖÂÆπ„Å®ÂõûÁ≠îÂÜÖÂÆπ„ÅÆÊòéÁ¢∫„Å™Âå∫ÂàÜ
3. Ë©¶È®ì„ÉªÊ§úÂÆö„ÉªË≥áÊ†ºÁâπÊúâ„ÅÆÁî®Ë™ûÔºàÁ¥ö„ÄÅÂèóÈ®ì„ÄÅË©¶È®ìÊñôÁ≠âÔºâÊ≠£Á¢∫„Å™Ë®òËºâ
4. È°ßÂÆ¢ÊÉÖÂ†±„ÄÅÂèóÈ®ìÂÜÖÂÆπ„ÄÅË≥™ÂïèÂÜÖÂÆπ„ÅÆÊ≠£Á¢∫„Å™ÊäΩÂá∫
5. ÂØæÂøúÊâãÈ†Ü„Å®Ê°àÂÜÖÂÜÖÂÆπ„ÅÆÁ∞°ÊΩî„Å™„Åæ„Å®„ÇÅ
6. **ÊúÄÈáçË¶Å: ‰∫∫Áâ©Âêç„ÅØ„Åô„Åπ„Å¶„Ç´„Çø„Ç´„ÉäË°®Ë®ò„Å´Áµ±‰∏Ä„ÄÇ**
7. Ë©¶È®ìÂêçÔºàÊ§úÂÆöÂêçÔºâ„ÅÆ„Äå„ÄáÁ¥ö„Äç„ÅØÁúÅÁï•„Åõ„Åö„ÄÅ**Ê≠£Á¢∫„Å´Ë°®Á§∫**„ÄÇ
8. Ë¶ÅÁ¥ÑÊñáÁ´†„ÅØÂÆåÁµê„ÅßË®Ä„ÅÑÂàá„Çä„ÄÅ‰ΩìË®ÄÊ≠¢„ÇÅ„ÅßË®òËø∞„ÄÇ
9. „ÄåÂõûÁ≠î„ÉªÊ°àÂÜÖÂÜÖÂÆπ„Äç„Å®„ÄåÂØæÂøúÁµêÊûú„Äç„Çª„ÇØ„Ç∑„Éß„É≥„Åß„ÅØ„ÄÅÂØæË±°„Å®„Å™„ÇãË©¶È®ì„ÉªÊ§úÂÆö„ÉªË≥áÊ†º„ÅÆÂêçÁß∞Ôºà‰æã: Êº¢Â≠óÊ§úÂÆö2Á¥öÔºâ„Çí**ÂøÖ„ÅöÂê´„ÇÅ„Çã**„ÄÇ

### Âá∫ÂäõÂΩ¢Âºè
## **È°ßÂÆ¢ÊÉÖÂ†±**
Ôºà„ÉÜ„Ç≠„Çπ„Éà„Åã„ÇâÊäΩÂá∫„Åó„ÅüÈ°ßÂÆ¢„ÅÆÂ±ûÊÄßÔºöÂèóÈ®ìËÄÖÊú¨‰∫∫„ÄÅÂõ£‰ΩìÊãÖÂΩìËÄÖ„ÄÅ‰øùË≠∑ËÄÖ„ÄÅ‰ª£ÁêÜ„ÄÅË©¶È®ìÁÆ°Ôºâ
## **ÂïèÂêà„Åõ„Ç´„ÉÜ„Ç¥„É™„Éº**
ÔºàË≥™ÂïèÂÜÖÂÆπÔºàÂæ©Âî±ÂÜÖÂÆπÔºâ„Å´„Åù„Å£„Å¶‰ª•‰∏ã„Ç´„ÉÜ„Ç¥„É™„Éº„ÇíÈÅ∏Êäû„ÄÇ
ÔºÉ„Ç´„ÉÜ„Ç¥„É™„Éº
1.ÂÄã‰∫∫ÊÉÖÂ†±ÁôªÈå≤/Á¢∫Ë™ç/‰øÆÊ≠£/ÂâäÈô§
2.Áî≥Ëæº/ÊîØÊâï
3.È°òÊõ∏/„Éë„É≥„Éï„É¨„ÉÉ„ÉàÂ∏åÊúõ
4.‰∫àÁ¥ÑÁ¢∫Ë™ç/Â§âÊõ¥/„Ç≠„É£„É≥„Çª„É´
5.ÂèóÈ®ìË≥áÊ†º
6.ÂÜçÂèóÈ®ì
7.Âá∫È°åÂΩ¢Âºè/Ë©¶È®ìÂÜÖÂÆπ
8.Â≠¶ÁøíÊñπÊ≥ï/„ÉÜ„Ç≠„Çπ„Éà
9.Ë©¶È®ìÊó•Á®ã/‰ºöÂ†¥/Á©∫Â∏≠ÁÖß‰ºö
10.Ë´ãÊ±ÇÊõ∏/È†òÂèéÊõ∏
11.ÂèóÈ®ìÁ•®
12.ÈÅÖÂàª/Ê¨†Â∏≠/ÈÅìÊ°àÂÜÖ
13.ÂΩìÊó•„ÅÆÊåÅ„Å°Áâ©
14.Êú¨‰∫∫Á¢∫Ë™çÊõ∏È°û„ÅÆÁ¢∫Ë™ç/ÊèêÂá∫
15.Ë©¶È®ìÁµêÊûú/„É¨„Éù„Éº„Éà/ÂêàÊ†ºË®ºÊõ∏„ÉªÈÄöÁü•Êõ∏
16.ÂêàÊ†ºÂü∫Ê∫ñ/Ëß£Á≠î/ÁñëÁæ©
17.Ë©¶È®ìÂæå„ÅÆÊâãÁ∂ö„Åç
18.„Åù„ÅÆ‰ªñË©¶È®ìÂà∂Â∫¶
19.Êäò„ÇäËøî„Åó
20.Ëøî‰ø°‰∏çË¶Å
21.ÁÅΩÂÆ≥Èñ¢ÈÄ£
22.„Ç∑„Çπ„ÉÜ„É†Èñ¢ÈÄ£
23.Ë©¶È®ìÂΩìÊó•ÈÅãÂñ∂ÔºàPBTÔºâ
24.„Ç´„ÉÜ„Ç¥„É™Â§ñÔºâ
## **Ë©¶È®ì„ÉªÊ§úÂÆöÂÜÖÂÆπ**
ÔºàÂØæË±°Ë©¶È®ì„ÉªÊ§úÂÆö„ÉªË≥áÊ†ºÂêç„ÄÇ**„ÄáÁ¥ö„ÅØÂê´„ÇÅ„Å™„ÅÑ**Ôºâ

## **Ë≥™Âïè„ÉªÂïè„ÅÑÂêà„Çè„ÅõÂÜÖÂÆπ**
ÔºàÂæ©Âî±„Åó„ÅüË≥™Âïè„ÇíÁ∞°ÊΩî„Å´Ë¶ÅÁ¥Ñ„ÄÅË§áÊï∞Ë≥™Âïè„ÅØ‚ë†‚ë°„ÅßÁï™Âè∑ÂàÜ„ÅëÔºâ

## **ÂõûÁ≠î„ÉªÊ°àÂÜÖÂÜÖÂÆπ**
ÔºàË≥™Âïè„Å∏„ÅÆÂõûÁ≠î„Å®ÊâãÈ†ÜÊ°àÂÜÖ„ÇíÁ∞°ÊΩî„Å´Ë¶ÅÁ¥Ñ„ÄÅË§áÊï∞ÂõûÁ≠î„ÅØ‚ë†‚ë°„ÅßÁï™Âè∑ÂàÜ„Åë„ÄÇÂêÑÂõûÁ≠î„ÅÆÊúÄÂæå„ÅØ"ÔΩû„Å®Ê°àÂÜÖ"„ÅßÁµ±‰∏Ä„ÄÇ**ÂØæË±°Ë©¶È®ì„ÉªÊ§úÂÆö„ÉªË≥áÊ†º„ÅÆÂêçÁß∞„ÇíÂøÖ„ÅöÂê´„ÇÅ„Çã**Ôºâ

## **ÂØæÂøúÁµêÊûú**
Ôºà„ÉÜ„Ç≠„Çπ„Éà„Åã„ÇâÈ°ßÂÆ¢„ÅÆÊ∞èÂêçÔºà„Ç´„Çø„Ç´„ÉäÔºâ„ÄÅÂèóÈ®ì„Åó„ÅüË©¶È®ìÂêçÔºà„ÄáÁ¥ö„ÇÇÂê´„ÇÄÔºâ„ÇíÂøÖ„ÅöÊäΩÂá∫„Åó„ÄÅÊúÄÁµÇÁöÑ„Å™ÂØæÂøúÂÜÖÂÆπ„Å®Âêà„Çè„Åõ„Å¶„ÄåÔºàÊ∞èÂêçÔºâÊßò„Å∏ÔºàË©¶È®ìÂêçÔºâ„Å´„Å§„ÅÑ„Å¶‚óã‚óã„ÇíÊ°àÂÜÖÊ∏à„Äç„ÅÆÂΩ¢Âºè„ÅßË®òËºâÔºâ

## **Á∂ôÁ∂öÂØæÂøú„ÉªÁâπË®ò‰∫ãÈ†Ö**
ÔºàÁ∂ôÁ∂öÂØæÂøú„ÅåÂøÖË¶Å„Å™‰∫ãÈ†Ö„ÄÅÈáçË¶ÅÊÉÖÂ†±Ë®òËºâÔºâ`,
            
            support: `„ÅÇ„Å™„Åü„ÅØ„Ç´„Çπ„Çø„Éû„Éº„Çµ„Éù„Éº„Éà„Çª„É≥„Çø„Éº„ÅÆ„Éó„É≠„Åß„Åô„ÄÇ‰ª•‰∏ã„ÅÆÊù°‰ª∂„Å®Âá∫ÂäõÂΩ¢Âºè„Å´Ê≤ø„Å£„Å¶„ÄÅÊúÄÂæå„Å´Âºµ„Çä‰ªò„Åë„ÅüÊñáÁ´†„ÅÆÁîüÊàê„ÇíË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

### ËÉåÊôØ
„Éª„Éâ„É©„Éï„Éà„ÅØÂèóÈõªÂØæÂøúËÄÖ„ÅÆÈü≥Â£∞„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„Åø„Åß„Åô„ÄÇ
„Éª„Éâ„É©„Éï„Éà„ÅØ„ÇØ„É©„Ç§„Ç¢„É≥„Éà„Å∏ÊèêÂá∫„Åô„Çã„Åü„ÇÅ„ÅÆÂ±•Ê≠¥„Åß„Åô„ÄÇ

# Êù°‰ª∂
**„Éâ„É©„Éï„Éà„ÅÆÊñáÁ´†„Çí‰ª•‰∏ã„ÅÆ6„Å§„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„Å´Êï¥ÁêÜ„Åó„ÄÅË¶ÅÁÇπ„ÇíÁ∞°ÊΩî„Å´„Åæ„Å®„ÇÅ„ÄÇ**
1. Ë™§Â≠óËÑ±Â≠ó„ÄÅ„Å¶„Å´„Åä„ÅØ‰øÆÊ≠£„ÄÅËá™ÁÑ∂„Å™ÊñáÁ´†Ë°®Áèæ
2. Ë≥™Âïè„Å®ÂõûÁ≠î„ÅÆÊòéÁ¢∫„Å™Âå∫ÂàÜ
3. Ë≥™Âïè„Å®ÂõûÁ≠î‰ª•Â§ñ„ÅÆÂÜÖÂÆπË¶ÅÁ¥Ñ
4. ‰∏ªË™û„Å®Ëø∞Ë™û„ÅÆÊòéÁ¢∫Âåñ
5. Âá∫ÂäõÂΩ¢Âºè„Å∏„ÅÆÊï¥ÁêÜ
6. **ÊúÄÈáçË¶Å: ‰∫∫Áâ©Âêç„ÅØ„Åô„Åπ„Å¶„Ç´„Çø„Ç´„ÉäË°®Ë®ò„Å´Áµ±‰∏Ä„ÄÇ**
7. Ë©¶È®ìÂêçÔºàÊ§úÂÆöÂêçÔºâ„ÅÆ„Äå„ÄáÁ¥ö„Äç„ÅØÁúÅÁï•„Åõ„Åö„ÄÅ**Ê≠£Á¢∫„Å´Ë°®Á§∫**„ÄÇ
8. Ë¶ÅÁ¥ÑÊñáÁ´†„ÅØÂÆåÁµê„ÅßË®Ä„ÅÑÂàá„Çä„ÄÅ‰ΩìË®ÄÊ≠¢„ÇÅ„ÅßË®òËø∞„ÄÇ
9. „ÄåÂõûÁ≠îÂÜÖÂÆπ„Äç„Å®„ÄåÁµêË´ñ„Äç„Çª„ÇØ„Ç∑„Éß„É≥„Åß„ÅØ„ÄÅÂØæË±°„Å®„Å™„ÇãË©¶È®ì„ÉªÊ§úÂÆö„ÉªË≥áÊ†º„ÅÆÂêçÁß∞Ôºà‰æã: Êº¢Â≠óÊ§úÂÆö2Á¥öÔºâ„ÄÅÂèóÈ®ìËÄÖÊ∞èÂêçÔºà„Ç´„Çø„Ç´„ÉäÔºâ„Çí**ÂøÖ„ÅöÂê´„ÇÅ„Çã**„ÄÇ

# Âá∫ÂäõÂΩ¢Âºè
## **ÂèóÈ®ìË©¶È®ìÔºà‰∫àÂÆöÂê´„ÇÄÔºâ** 
Ôºà„ÉÜ„Ç≠„Çπ„Éà„Åã„ÇâÊäΩÂá∫„ÄÇ„ÄáÁ¥ö„ÅØÂê´„ÇÅ„Å™„ÅÑÔºâ
## **ÂèóÈ®ìÊñπÊ≥ï**
ÂÄã‰∫∫/Âõ£‰Ωì
## **ÂØæÂøúËÄÖ**
ÂèóÈ®ìËÄÖ/‰øùË≠∑ËÄÖ/‰ª£ÁêÜ/Âõ£‰ΩìÊãÖÂΩìËÄÖ/Ë©¶È®ìÂÆò

## **Ë≥™ÂïèÂÜÖÂÆπ**
„ÉÜ„Ç≠„Çπ„Éà„ÇíÂü∫„Å´Âæ©Âî±„Åó„ÅüË≥™Âïè„ÇíÁ∞°ÊΩî„Å´Ë¶ÅÁ¥Ñ
ÔºàË§áÊï∞Ë≥™Âïè„ÅØ‚ë†‚ë°„ÅßÁï™Âè∑ÂàÜ„ÅëÔºâ

## **ÂõûÁ≠îÂÜÖÂÆπ**
**Ë≥™Âïè„Å∏„ÅÆÂõûÁ≠î„Å®ÊâãÈ†ÜÊ°àÂÜÖ„ÇíÁ∞°ÊΩî„Å´Ë¶ÅÁ¥Ñ**
ÔºàË§áÊï∞ÂõûÁ≠î„ÅØ‚ë†‚ë°„ÅßÁï™Âè∑ÂàÜ„Åë„ÄÇÂõûÁ≠î„ÅÆÊúÄÂæå„ÅØ"ÔΩû„Å®Ê°àÂÜÖ"„ÅßÁµ±‰∏Ä„ÄÇ**ÂØæË±°Ë©¶È®ì„ÉªÊ§úÂÆö„ÉªË≥áÊ†º„ÅÆÂêçÁß∞„ÇíÂøÖ„ÅöÂê´„ÇÅ„Çã**Ôºâ

## **ÁµêË´ñ**
**„ÉÜ„Ç≠„Çπ„Éà„Åã„ÇâÈ°ßÂÆ¢„ÅÆÊ∞èÂêçÔºà„Ç´„Çø„Ç´„ÉäÔºâ„ÄÅÂèóÈ®ì„Åó„ÅüË©¶È®ìÂêçÔºà„ÄáÁ¥ö„ÇÇÂê´„ÇÄÔºâ„ÇíÂøÖ„ÅöÊäΩÂá∫„Åó„ÄÅÊúÄÁµÇÁöÑ„Å™ÂØæÂøúÂÜÖÂÆπ„Å®Âêà„Çè„Åõ„Å¶„ÄåÔºàÊ∞èÂêçÔºâÊßò„Å∏ÔºàË©¶È®ìÂêçÔºâ„Å´„Å§„ÅÑ„Å¶‚óã‚óã„ÇíÊ°àÂÜÖÊ∏à„Äç„ÅÆÂΩ¢Âºè„Åß‰ΩìË®ÄÊ≠¢„ÇÅ„ÅßË®òËºâ„ÄÇ**

## **ÁêÜÁî±**
**Á∞°ÊΩî„Å´Ë¶ÅÁ¥Ñ„ÄÅ‰ΩìË®ÄÊ≠¢„ÇÅ„ÅßË®òËø∞„ÄÇ**

## **„Éó„É≠„Çª„Çπ**
**Á∞°ÊΩî„Å´Ë¶ÅÁ¥Ñ„ÄÅ‰ΩìË®ÄÊ≠¢„ÇÅ„ÅßË®òËø∞„ÄÇ**`,
            
            custom: ''
        };

        // === „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞ ===
        function log(message) {
            const time = new Date().toLocaleTimeString();
            const logMessage = `[${time}] ${message}`;
            console.log(logMessage);
            const debugLog = document.getElementById('debugLog');
            if (debugLog) {
                debugLog.innerHTML += logMessage + '<br>';
                debugLog.scrollTop = debugLog.scrollHeight;
            }
        }
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = 'notification';
            document.body.appendChild(notification);
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }
        function formatDuration(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        function updateStatus(elementId, text, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
                element.className = `status-value ${type}`;
            }
        }
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // === Ë¶ÅÁ¥ÑÊ©üËÉΩ„ÅÆÈ†ÖÁõÆÂà•„Ç≥„Éî„ÉºÂØæÂøú ===
        /**
         * @description Ë¶ÅÁ¥Ñ„ÉÜ„Ç≠„Çπ„Éà„ÇíËß£Êûê„Åó„ÄÅË¶ãÂá∫„Åó„Çí„Ç≠„Éº„Å®„Åô„Çã„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ„Åô„Çã
         * @param {string} summary - ## „ÇÑ ### „ÇíÂê´„ÇÄ„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥ÂΩ¢Âºè„ÅÆË¶ÅÁ¥Ñ„ÉÜ„Ç≠„Çπ„Éà
         * @returns {Object} Ë¶ãÂá∫„Åó„Çí„Ç≠„Éº„ÄÅÂÜÖÂÆπ„ÇíÂÄ§„Å®„Åô„Çã„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
         */
        function parseSummaryData(summary) {
            const data = {};
            // „Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥„ÅÆË¶ãÂá∫„Åó(## or ###)„ÇíË°åÈ†≠„ÅßÂå∫Âàá„Çä„ÄÅÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥„Å´ÂàÜÂâ≤„Åô„Çã
            const sections = summary.split(/(?=^##\s|###\s)/m); 
            for (const section of sections) {
                if (section.trim() === '') continue;
                const lines = section.trim().split('\n');
                // ÊúÄÂàù„ÅÆË°å„ÇíË¶ãÂá∫„Åó„Å®„Åó„Å¶ÊäΩÂá∫„Åó„ÄÅ„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Ë®òÂè∑„ÇÑË£ÖÈ£æ„ÇíÈô§Âéª
                const header = lines.shift().replace(/^[#\s]+/, '').replace(/\*\*/g, '').trim();
                const content = lines.join('\n').trim();
                if (header) {
                    data[header] = content;
                }
            }
            return data;
        }
        
        function formatSummaryWithCopy(summary) {
            let formatted = summary
                .replace(/## (.*?)$/gm, '<h2 data-section="$1" title="„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç≥„Éî„Éº">$1</h2>')
                .replace(/### (.*?)$/gm, '<h3 data-section="$1" title="„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç≥„Éî„Éº">$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
            return formatted.replace(/<h([23]) data-section="([^"]*)">(.*?)<\/h[23]>(.*?)(?=<h[23]|$)/gs, '<div class="summary-section" data-section="$2"><h$1 data-section="$2">$3</h$1>$4</div>');
        }

        function addCopyEventListeners() {
            document.getElementById('summaryContent').querySelectorAll('[data-section]').forEach(el => {
                el.addEventListener('click', () => copySummarySection(el.getAttribute('data-section')));
            });
        }
        
        /**
         * @description ÊåáÂÆö„Åï„Çå„Åü„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂÜÖÂÆπ„Çí„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åô„Çã
         * @param {string} sectionName - „Ç≥„Éî„Éº„Åô„Çã„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆË¶ãÂá∫„ÅóÂêç
         */
        function copySummarySection(sectionName) {
            const textToCopy = summaryData[sectionName];
            if (textToCopy === undefined) {
                showNotification(`‚ùå „Äå${sectionName}„Äç„ÅÆÂÜÖÂÆπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì`);
                return;
            }
            
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification(`‚úÖ „Äå${sectionName}„Äç„ÅÆÂÜÖÂÆπ„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`);
            } catch (err) {
                showNotification('‚ùå „Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
            document.body.removeChild(textArea);
        }

        // === ÁµÇ‰∫ÜÂá¶ÁêÜ ===
        async function endSession() {
            if (isRecording) {
                stopRecording();
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            if (confirm('„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÅãÔºü\n„ÉªÁµêÊûú„Çí„É≠„Éº„Ç´„É´„Å´‰øùÂ≠ò\n„ÉªÁµ±Ë®à„Çí„ÇØ„É™„Ç¢')) {
                try {
                    if (transcript.trim()) await saveTranscriptToLocal();
                    clearTranscript();
                    clearStatistics();
                    closeSummaryPopup();
                    showNotification('‚úÖ „Çª„ÉÉ„Ç∑„Éß„É≥„ÅåÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü');
                } catch (error) {
                    showNotification(`‚ùå ÁµÇ‰∫ÜÂá¶ÁêÜ„Ç®„É©„Éº: ${error.message}`);
                }
            }
        }
        async function saveTranscriptToLocal() {
            const saveContent = generateSaveContent();
            try {
                if ('showDirectoryPicker' in window) {
                    if (!saveDirectory) saveDirectory = await window.showDirectoryPicker({ mode: 'readwrite' });
                    const fileHandle = await saveDirectory.getFileHandle(`Ë®òÈå≤_${new Date().toISOString().slice(0,10)}.txt`, { create: true });
                    const writable = await fileHandle.createWritable();
                    await writable.write(saveContent);
                    await writable.close();
                } else {
                    downloadTextWithStats();
                }
            } catch (error) {
                if (error.name !== 'AbortError') downloadTextWithStats();
            }
        }
        function generateSaveContent() {
            const avgDuration = callCount > 0 ? Math.floor(totalDuration / callCount) : 0;
            return `Êó•‰ªò: ${new Date().toLocaleString('ja-JP')}
ÈÄöË©±Êï∞: ${callCount}Âõû
Á¥ØË®àÊôÇÈñì: ${formatDuration(totalDuration)}
Âπ≥ÂùáÊôÇÈñì: ${formatDuration(avgDuration)}
--------------------
${transcript}`;
        }
        function downloadTextWithStats() {
            const filename = `Ë®òÈå≤_${new Date().toISOString().slice(0,10)}.txt`;
            const blob = new Blob([generateSaveContent()], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        function clearTranscript() {
            transcript = '';
            transcriptHTML = '';
            updateTranscriptDisplay();
            updateUI();
        }
        function clearStatistics() {
            if (callTimer) clearInterval(callTimer);
            callTimer = null;
            callCount = 0;
            currentCallDuration = 0;
            totalDuration = 0;
            currentCallStart = null;
            localStorage.removeItem('call_statistics');
            updateStatistics();
        }

        // === „ÉÜ„É≥„Éó„É¨„Éº„ÉàÁÆ°ÁêÜ ===
        function onTemplateSelectChange() {
            const select = document.getElementById('templateSelect');
            const nameInput = document.getElementById('newTemplateName');
            const contentTextarea = document.getElementById('templateContentTextarea');
            const selectedName = select.value;
            if (selectedName && templates[selectedName]) {
                nameInput.value = selectedName;
                contentTextarea.value = templates[selectedName];
            } else {
                nameInput.value = '';
                contentTextarea.value = '';
            }
        }
        function loadTemplates() {
            const saved = localStorage.getItem('saved_templates');
            if (saved) {
                templates = JSON.parse(saved);
                updateTemplateSelect();
            }
        }
        function saveTemplates() {
            localStorage.setItem('saved_templates', JSON.stringify(templates));
        }
        function updateTemplateSelect() {
            const select = document.getElementById('templateSelect');
            select.innerHTML = '<option value="">„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÈÅ∏Êäû...</option>';
            Object.keys(templates).forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
        }
        function saveTemplate() {
            const name = document.getElementById('newTemplateName').value.trim();
            const content = document.getElementById('templateContentTextarea').value.trim();
            if (!name || !content) { showNotification('ÂêçÂâç„Å®ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; }
            templates[name] = content;
            saveTemplates();
            updateTemplateSelect();
            document.getElementById('templateSelect').value = name;
            showNotification(`„ÉÜ„É≥„Éó„É¨„Éº„Éà„Äå${name}„Äç„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü`);
        }
        function deleteTemplate() {
            const selectedName = document.getElementById('templateSelect').value;
            if (!selectedName) { showNotification('ÂâäÈô§„Åô„Çã„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; }
            if (confirm(`„Äå${selectedName}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
                delete templates[selectedName];
                saveTemplates();
                updateTemplateSelect();
                onTemplateSelectChange();
                showNotification(`„ÉÜ„É≥„Éó„É¨„Éº„Éà„Äå${selectedName}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`);
            }
        }
        function editTemplate() {
            const selectedName = document.getElementById('templateSelect').value;
            if (!selectedName) { showNotification('Á∑®ÈõÜ„Åô„Çã„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; }
            document.getElementById('templateContentTextarea').focus();
        }
        function loadTemplate() {
            const selectedName = document.getElementById('templateSelect').value;
            if (!selectedName) { showNotification('Ë™≠„ÅøËæº„ÇÄ„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; }
            transcript = templates[selectedName];
            transcriptHTML = escapeHtml(transcript).replace(/\n/g, '<br>');
            updateTranscriptDisplay();
            updateUI();
        }
        function importTemplate(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                const name = prompt('„ÉÜ„É≥„Éó„É¨„Éº„ÉàÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', file.name.replace(/\.[^/.]+$/, ""));
                if (name) {
                    templates[name] = content;
                    saveTemplates();
                    updateTemplateSelect();
                    document.getElementById('templateSelect').value = name;
                    onTemplateSelectChange();
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        // === „Éó„É≠„É≥„Éó„ÉàÁÆ°ÁêÜ ===
        function updatePromptPreview() {
            const select = document.getElementById('promptSelect');
            const preview = document.getElementById('promptPreview');
            const selected = select.value;
            preview.textContent = (selected === 'custom') ? (localStorage.getItem('custom_prompt') || '„Ç´„Çπ„Çø„É†Êú™Ë®≠ÂÆö') : prompts[selected].substring(0, 100) + '...';
            currentPrompt = selected;
            localStorage.setItem('selected_prompt', selected);
        }
        function editPrompt() {
            const select = document.getElementById('promptSelect');
            let currentText = (select.value === 'custom') ? localStorage.getItem('custom_prompt') || '' : prompts[select.value];
            const newPrompt = prompt("„Éó„É≠„É≥„Éó„Éà„ÇíÁ∑®ÈõÜ:", currentText);
            if (newPrompt !== null) {
                select.value = 'custom';
                localStorage.setItem('custom_prompt', newPrompt);
                updatePromptPreview();
            }
        }

        // === Â≠¶ÁøíÊ©üËÉΩ ===
        /**
         * @description ÁôªÈå≤„Åï„Çå„ÅüÂ≠¶Áøí„Éá„Éº„Çø„Åã„Çâ„ÄÅÁΩÆÊèõÁî®„ÅÆÂçò‰∏Ä„ÅÆÊ≠£Ë¶èË°®Áèæ„Å®„Éû„ÉÉ„Éó„ÇíÁîüÊàê„Åô„Çã„ÄÇ
         * Èï∑„ÅÑÂçòË™û„Åã„ÇâÂÖà„Å´„Éû„ÉÉ„ÉÅ„Åô„Çã„Çà„ÅÜ„Å´„ÇΩ„Éº„Éà„Åô„Çã„Åì„Å®„Åß„ÄÅË™§„Éû„ÉÉ„ÉÅ„ÇíÈò≤„Åê„ÄÇ
         */
        function buildLearningDataRegex() {
            learningDataMap.clear();
            if (Object.keys(learningData).length === 0) {
                learningDataRegex = null;
                return;
            }
            const keys = Object.keys(learningData).sort((a, b) => b.length - a.length);
            for (const key of keys) {
                learningDataMap.set(key.toLowerCase(), learningData[key]);
            }
            const regexString = `\\b(${keys.map(escapeRegex).join('|')})\\b`;
            learningDataRegex = new RegExp(regexString, 'gi');
        }

        function loadLearningData() {
            const saved = localStorage.getItem('speech_learning_data');
            if (saved) {
                learningData = JSON.parse(saved);
            } else {
                learningData = { "‰ª∂Âêç": "„ÅîÁî®‰ª∂", "„Åä‰º∫„Åó„Çá„ÅÜ„Åã„ÅÑ": "„Åä‰º∫„ÅÑ„Åß„Åç„Åæ„Åô„Åß„Åó„Çá„ÅÜ„Åã", "„ÅäËÅû„Åç„Åó„Çá„ÅÜ„Åã„ÅÑ": "„ÅäËÅû„Åç„Åß„Åç„Åæ„Åô„Åß„Åó„Çá„ÅÜ„Åã", "Á¢∫‰∫∫": "Á¢∫Ë™ç", "„ÅîÁ¢∫‰∫∫": "„ÅîÁ¢∫Ë™ç", "Ëß£Á≠î": "ÂõûÁ≠î", "„ÅäÁ≠îÊ°à": "„ÅäÂõûÁ≠î", "Èñ¢‰øÇ": "Êº¢Ê§ú", "Èñ¢Ë•ø": "Êº¢Ê§ú", "ÈñìÁ≥ª": "Êº¢Ê§ú", "Êº¢Á≥ª": "Êº¢Ê§ú", "ÈõÜ‰∏≠": "ÊâøÁü•", "ÁøíÂæó": "ÊâøÁü•", "‰øÆÂæó": "ÊâøÁü•", "ÁêÜËß£": "‰∫ÜËß£", "Âà©ÂÆ≥": "‰∫ÜËß£", "Â±•Ê≠¥": "‰∫ÜËß£", "ÊîØÂ∫óÂêç": "Ë©¶È®ìÂêç", "„Åó„Å¶„ÇìÂêç": "Ë©¶È®ìÂêç", "ÊîØÂ∫ó„ÇÅ„ÅÑ": "Ë©¶È®ìÂêç", "„Åó„Å¶„Çì„ÇÅ„ÅÑ": "Ë©¶È®ìÂêç", "ÊîØÂ∫óÂêç„Åå": "Ë©¶È®ìÂêç„Åå", "„Åó„Å¶„ÇìÂêç„Åå": "Ë©¶È®ìÂêç„Åå", "ÊåáÂÆöÂêç": "Ë©¶È®ìÂêç", "„Åó„Å¶„ÅÑÂêç": "Ë©¶È®ìÂêç", "Â∏ÇÂ∫óÂêç": "Ë©¶È®ìÂêç", "„Åó„Å¶„Çì„Å™": "Ë©¶È®ìÂêç", "10‰ª∂": "ÂèóÈ®ì", "„Åò„ÇÖ„Å£„Åë„Çì": "ÂèóÈ®ì", "10Ê§ú": "ÂèóÈ®ì", "ÂçÅ‰ª∂": "ÂèóÈ®ì", "„Åò„ÇÖ„ÅÜ„Åë„Çì": "ÂèóÈ®ì", "Èáç‰ª∂": "ÂèóÈ®ì", "‰Ωè‰ª∂": "ÂèóÈ®ì", "ÂÖÖ‰ª∂": "ÂèóÈ®ì", "10Ëªí": "ÂèóÈ®ì", "10Âà∏": "ÂèóÈ®ì", "10Â∑ª": "ÂèóÈ®ì", "ÂçÅÊ§ú": "ÂèóÈ®ì", "ÂçÅÂà∏": "ÂèóÈ®ì", "ÂçÅÂ∑ª": "ÂèóÈ®ì", "Ë©¶È®ìÂÆò": "Ë©¶È®ì", "Ë≥¢Êòé": "Ê§úÂÆö", "Ê§úÂÆöÊÑü": "Ê§úÂÆö", "ÂÅ•Â∫∑": "Ê§úÂÆö", "Ë©¶Âêà": "Ë©¶È®ì", "Ë≥áÊ†º„Åã„Çì": "Ë≥áÊ†º", "Ë≥áÊ†ºÈñì": "Ë≥áÊ†º", "„Åó„Åã„ÅèÊÑü": "Ë≥áÊ†º", "Êº¢Â≠óÂà∏": "Êº¢Â≠óÊ§úÂÆö", "Êº¢Â≠ó„Åë„Çì": "Êº¢Â≠óÊ§úÂÆö", "Êº¢Â≠óËªí": "Êº¢Â≠óÊ§úÂÆö", "ÂÆåÊ≤ªÊ§úÂÆö": "Êº¢Â≠óÊ§úÂÆö", "ÊÑü„ÅòÊ§úÂÆö": "Êº¢Â≠óÊ§úÂÆö", "ÂèóÈ®ìÊÑü": "ÂèóÈ®ì", "ÂèóÊ§úÈñì": "ÂèóÈ®ì", "„Åò„ÇÖ„Åë„ÇìÊÑü": "ÂèóÈ®ì", "Áî≥„ÅóËæº„ÅøÊÑü": "Áî≥„ÅóËæº„Åø", "Áî≥ËæºÊÑü": "Áî≥„ÅóËæº„Åø", "„ÇÇ„ÅÜ„Åó„Åì„ÅøÊÑü": "Áî≥„ÅóËæº„Åø", "ÂèóÈ®ìÊñôÈáë": "ÂèóÈ®ìÊñô", "„Åò„ÇÖ„Åë„Çì„Çä„Çá„ÅÜ": "ÂèóÈ®ìÊñô", "Ê§úÂÆöÊñôÈáë": "Ê§úÂÆöÊñô", "„Åë„Çì„Å¶„ÅÑ„Çä„Çá„ÅÜ": "Ê§úÂÆöÊñô", "Ë©¶È®ìÊó•ÊÑü": "Ë©¶È®ìÊó•", "„Åó„Åë„ÇìÊó•": "Ë©¶È®ìÊó•", "ÂèóÈ®ìÊó•ÊÑü": "ÂèóÈ®ìÊó•", "„Åò„ÇÖ„Åë„ÇìÊó•": "ÂèóÈ®ìÊó•", "Áî≥ËæºÊúüÈñì": "Áî≥ËæºÊúüÈñì", "„ÇÇ„ÅÜ„Åó„Åì„ÅøÊúüÈñì": "Áî≥ËæºÊúüÈñì", "Á∑†ÂàáÊó•": "Á∑†Âàá", "„Åó„ÇÅ„Åç„Çä": "Á∑†Âàá", "ÊúüÈôêÊó•": "ÊúüÈôê", "„Åç„Åí„Çì": "ÊúüÈôê", "„Åô„ÅÑ„Åæ„Åõ„Çì": "„Åô„Åø„Åæ„Åõ„Çì", "„Åô„ÅÑ„Åæ„Åà„Çì": "„Åô„Åø„Åæ„Åõ„Çì", "„Åô„Åø„Åæ„Åà„Çì": "„Åô„Åø„Åæ„Åõ„Çì", "„ÅÑ„Å£„Çâ„Åó„ÇÉ„Çã": "„ÅÑ„Çâ„Å£„Åó„ÇÉ„ÅÑ„Åæ„Åõ", "„ÅÑ„Çâ„Åó„ÇÉ„Çã": "„ÅÑ„Çâ„Å£„Åó„ÇÉ„ÅÑ„Åæ„Åõ", "„Åî„Åñ„Åæ„Åô": "„Åî„Åñ„ÅÑ„Åæ„Åô", "„ÇÇ„ÅÜ„Åó„Çè„Åë": "Áî≥„ÅóË®≥", "„Åä„Åù„Çå„ÅÑ„Çä": "ÊÅê„ÇåÂÖ•„Çä", "„Å®„ÅÑ„ÅÇ„Çè„Åõ": "„ÅäÂïè„ÅÑÂêà„Çè„Åõ", "„ÇÇ„Çì„ÅÇ„Çè„Åõ": "„ÅäÂïè„ÅÑÂêà„Çè„Åõ", "ÊâãÁ∂ö": "ÊâãÁ∂ö„Åç", "„Å¶„Å§„Å•„Åç": "ÊâãÁ∂ö„Åç", "„Åã„Åè„Å´„Çì": "Á¢∫Ë™ç", "„Çå„Çì„Çâ„Åè": "ÈÄ£Áµ°", "„Åü„Çì„Å®„ÅÜ„Åó„ÇÉ": "ÊãÖÂΩìËÄÖ", "„Å≤„Å®„Å§": "1„Å§", "„Åµ„Åü„Å§": "2„Å§", "„Åø„Å£„Å§": "3„Å§", "„Çà„Å£„Å§": "4„Å§", "„ÅÑ„Å§„Å§": "5„Å§", "„ÇÄ„Å£„Å§": "6„Å§", "„Å™„Å™„Å§": "7„Å§", "„ÇÑ„Å£„Å§": "8„Å§", "„Åì„Åì„ÅÆ„Å§": "9„Å§", "„Å®„Åä": "10", "Â±±Áî∞": "„É§„Éû„ÉÄ", "Áî∞‰∏≠": "„Çø„Éä„Ç´", "‰ΩêËó§": "„Çµ„Éà„Ç¶", "Èà¥Êú®": "„Çπ„Ç∫„Ç≠", "È´òÊ©ã": "„Çø„Ç´„Éè„Ç∑", "Ê∏°Ëæ∫": "„ÉØ„Çø„Éä„Éô", "‰ºäËó§": "„Ç§„Éà„Ç¶", "‰∏≠Êùë": "„Éä„Ç´„É†„É©", "Â∞èÊûó": "„Ç≥„Éê„É§„Ç∑", "Âä†Ëó§": "„Ç´„Éà„Ç¶", "ÂêâÁî∞": "„É®„Ç∑„ÉÄ", "Â±±Êú¨": "„É§„Éû„É¢„Éà", "‰∫ï‰∏ä": "„Ç§„Éé„Ç¶„Ç®", "Êú®Êùë": "„Ç≠„É†„É©", "Êûó": "„Éè„É§„Ç∑", "ÊñéËó§": "„Çµ„Ç§„Éà„Ç¶", "Â±±Â¥é": "„É§„Éû„Ç∂„Ç≠", "Ê£Æ": "„É¢„É™", "Ê±†Áî∞": "„Ç§„Ç±„ÉÄ", "Ê©ãÊú¨": "„Éè„Ç∑„É¢„Éà", "ÈòøÈÉ®": "„Ç¢„Éô", "Áü≥Â∑ù": "„Ç§„Ç∑„Ç´„ÉØ", "‰∏≠Â≥∂": "„Éä„Ç´„Ç∏„Éû", "Â∞èÈáé": "„Ç™„Éé", "ÂÆÆÊú¨": "„Éü„É§„É¢„Éà", "ÂéüÁî∞": "„Éè„É©„ÉÄ", "Â≤°Áî∞": "„Ç™„Ç´„ÉÄ", "Èï∑Ë∞∑Â∑ù": "„Éè„Çª„Ç¨„ÉØ", "Ëó§Âéü": "„Éï„Ç∏„ÉØ„É©", "Á¶èÁî∞": "„Éï„ÇØ„ÉÄ", "Êùë‰∏ä": "„É†„É©„Ç´„Éü", "ËøëËó§": "„Ç≥„É≥„Éâ„Ç¶", "ÊùæÊú¨": "„Éû„ÉÑ„É¢„Éà", "‰∫ïÂè£": "„Ç§„Ç∞„ÉÅ", "ÂÜÖÁî∞": "„Ç¶„ÉÅ„ÉÄ", "Â§ßÈáé": "„Ç™„Ç™„Éé", "ËèäÂú∞": "„Ç≠„ÇØ„ÉÅ", "È´òÊú®": "„Çø„Ç´„ÇÆ", "‰∏äÈáé": "„Ç¶„Ç®„Éé", "ÊùâÂ±±": "„Çπ„ÇÆ„É§„Éû", "Â¢óÁî∞": "„Éû„Çπ„ÉÄ", "Á´πÂÜÖ": "„Çø„Ç±„Ç¶„ÉÅ", "ÈáëÂ≠ê": "„Ç´„Éç„Ç≥", "Ë•øÊùë": "„Éã„Ç∑„É†„É©", "ÂçÉËëâ": "„ÉÅ„Éê", "‰∏âÊµ¶": "„Éü„Ç¶„É©", "ÂùÇÊú¨": "„Çµ„Ç´„É¢„Éà", "Â∞èÂ≥∂": "„Ç≥„Ç∏„Éû", "ÈùíÊú®": "„Ç¢„Ç™„Ç≠", "ÊùæÁî∞": "„Éû„ÉÑ„ÉÄ", "‰∏≠Â∑ù": "„Éä„Ç´„Ç¨„ÉØ", "Ëó§Áî∞": "„Éï„Ç∏„Çø", "ÂæåËó§": "„Ç¥„Éà„Ç¶", "Áü≥Áî∞": "„Ç§„Ç∑„ÉÄ", "ÊùëÁî∞": "„É†„É©„Çø", "Â∞èÂ∑ù": "„Ç™„Ç¨„ÉØ", "Â≤°Êú¨": "„Ç™„Ç´„É¢„Éà", "Ê≤≥Èáé": "„Ç≥„Ç¶„Éé", "‰Ωê„ÄÖÊú®": "„Çµ„Çµ„Ç≠", "Êü¥Áî∞": "„Ç∑„Éê„Çø", "Ê≠¶Áî∞": "„Çø„Ç±„ÉÄ", "‰∏äÁî∞": "„Ç¶„Ç®„ÉÄ", "Ë•øÁî∞": "„Éã„Ç∑„ÉÄ", "ËèäÊ±†": "„Ç≠„ÇØ„ÉÅ", "ËèÖÂéü": "„Çπ„Ç¨„ÉØ„É©", "ÈáéÂè£": "„Éé„Ç∞„ÉÅ", "‰∏∏Â±±": "„Éû„É´„É§„Éû", "Âπ≥Èáé": "„Éí„É©„Éé", "Â§ßÂ°ö": "„Ç™„Ç™„ÉÑ„Ç´", "ÊùâÊú¨": "„Çπ„ÇÆ„É¢„Éà", "ÂêâÂ∑ù": "„É®„Ç∑„Ç´„ÉØ", "ÂÆÆÂ¥é": "„Éü„É§„Ç∂„Ç≠", "Âéü": "„Éè„É©", "Ê®™Â±±": "„É®„Ç≥„É§„Éû", "‰∏≠Èáé": "„Éä„Ç´„Éé", "Â∞èÈáéÂØ∫": "„Ç™„Éé„Éá„É©", "ÊùæÂ∞æ": "„Éû„ÉÑ„Ç™", "Áü≥‰∫ï": "„Ç§„Ç∑„Ç§", "Â§ßÊ©ã": "„Ç™„Ç™„Éè„Ç∑", "È´òÁî∞": "„Çø„Ç´„ÉÄ", "Â∞èÂÆÆ": "„Ç≥„Éü„É§", "È£ØÁî∞": "„Ç§„Ç§„ÉÄ", "Ê∏°ÈÉ®": "„ÉØ„Çø„Éä„Éô", "‰ªä‰∫ï": "„Ç§„Éû„Ç§", "Â∑ù‰∏ä": "„Ç´„ÉØ„Ç´„Éü", "‰πÖ‰øù": "„ÇØ„Éú", "‰ΩêÈáé": "„Çµ„Éé", "Ê∏ÖÊ∞¥": "„Ç∑„Éü„Ç∫", "È´òÂ±±": "„Çø„Ç´„É§„Éû", "Ë∞∑Âè£": "„Çø„Éã„Ç∞„ÉÅ", "‰∏≠Ë∞∑": "„Éä„Ç´„Çø„Éã", "Ë•øÂ±±": "„Éã„Ç∑„É§„Éû", "ÈáéÊùë": "„Éé„É†„É©", "ÊµúÁî∞": "„Éè„Éû„ÉÄ", "Âπ≥Áî∞": "„Éí„É©„Çø", "ÊòüÈáé": "„Éõ„Ç∑„Éé", "Â†Ä": "„Éõ„É™", "ÂâçÁî∞": "„Éû„Ç®„ÉÄ", "ÊùæÊùë": "„Éû„ÉÑ„É†„É©", "‰∏âÂÆÖ": "„Éü„É§„Ç±", "Ê£ÆÁî∞": "„É¢„É™„Çø", "Â±±Âè£": "„É§„Éû„Ç∞„ÉÅ", "Â±±‰∏ã": "„É§„Éû„Ç∑„Çø", "Â±±‰∏≠": "„É§„Éû„Éä„Ç´", "Ê®™Áî∞": "„É®„Ç≥„Çø", "ÂêâÊùë": "„É®„Ç∑„É†„É©", "Ëã•Êûó": "„ÉØ„Ç´„Éê„É§„Ç∑" };
                saveLearningData();
            }
            updateLearningStats();
            buildLearningDataRegex();
        }
        function saveLearningData() { localStorage.setItem('speech_learning_data', JSON.stringify(learningData)); }
        function updateLearningStats() {
            document.getElementById('learningCount').textContent = `${Object.keys(learningData).length}‰ª∂`;
            document.getElementById('sessionCorrectionCount').textContent = `${sessionCorrectionCount}‰ª∂`;
            document.getElementById('autoCorrectionCount').textContent = `${autoCorrectionCount}‰ª∂`;
        }
        function addLearningData() {
            const original = document.getElementById('originalText').value.trim();
            const corrected = document.getElementById('correctedText').value.trim();
            if (!original || !corrected) { showNotification('‚ùå ‰∏°Êñπ„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; }
            if (original === corrected) { showNotification('‚ùå ‰øÆÊ≠£Ââç„Å®‰øÆÊ≠£Âæå„ÅåÂêå„Åò„Åß„Åô'); return; }
            if (learningData[original] && !confirm(`„Äå${original}„Äç„ÅØÊó¢„Å´Â≠¶ÁøíÊ∏à„Åø„Åß„Åô„ÄÇ‰∏äÊõ∏„Åç„Åó„Åæ„Åô„ÅãÔºü`)) return;
            learningData[original] = corrected;
            saveLearningData();
            buildLearningDataRegex();
            updateLearningStats();
            document.getElementById('originalText').value = '';
            document.getElementById('correctedText').value = '';
            if (document.getElementById('learningDataDisplay').style.display !== 'none') showLearningData();
            showNotification(`‚úÖ Â≠¶Áøí„Éë„Çø„Éº„É≥„ÇíËøΩÂä†: ${original} ‚Üí ${corrected}`);
        }
        function showLearningData() {
            const display = document.getElementById('learningDataDisplay');
            if (Object.keys(learningData).length === 0) {
                display.innerHTML = '<p style="text-align: center; color: #666;">Â≠¶Áøí„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
            } else {
                display.innerHTML = Object.entries(learningData).map(([original, corrected]) => `
                        <div class="learning-item">
                            <div class="correction-text">
                                <span class="original">"${escapeHtml(original)}"</span> ‚Üí <span class="corrected">"${escapeHtml(corrected)}"</span>
                            </div>
                            <div class="actions">
                                <button class="btn btn-danger btn-small" onclick="deleteLearningData('${escapeHtml(original)}')">ÂâäÈô§</button>
                            </div>
                        </div>`).join('');
            }
            display.style.display = 'block';
        }
        function deleteLearningData(original) {
            if (confirm(`Â≠¶Áøí„Éë„Çø„Éº„É≥„Äå${original}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
                delete learningData[original];
                saveLearningData();
                buildLearningDataRegex();
                updateLearningStats();
                showLearningData();
                showNotification(`üóëÔ∏è Â≠¶Áøí„Éë„Çø„Éº„É≥„ÇíÂâäÈô§: ${original}`);
            }
        }
        function exportLearningData() {
            if (Object.keys(learningData).length === 0) { showNotification('‚ùå „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åô„ÇãÂ≠¶Áøí„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì'); return; }
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            const filename = `Ë©¶È®ìÊ•≠ÁïåÈü≥Â£∞Ë™çË≠òÂ≠¶Áøí„Éá„Éº„Çø_${timestamp}.json`;
            const exportData = {
                learningData: learningData,
                statistics: { sessionCorrections: sessionCorrectionCount, autoCorrections: autoCorrectionCount }
            };
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification(`üì§ Â≠¶Áøí„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü`);
        }
        function importLearningDataDialog() { document.getElementById('learningFileInput').click(); }
        function importLearningData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    const importedData = data.learningData || data;
                    if (Object.keys(importedData).length === 0) { showNotification('‚ùå „Ç§„É≥„Éù„Éº„ÉàÂèØËÉΩ„Å™„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü'); return; }
                    if (confirm(`${Object.keys(importedData).length}‰ª∂„ÅÆ„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÅãÔºü`)) {
                        Object.assign(learningData, importedData);
                        saveLearningData();
                        buildLearningDataRegex();
                        updateLearningStats();
                        showNotification(`üì• „Ç§„É≥„Éù„Éº„ÉàÂÆå‰∫Ü`);
                    }
                } catch (error) {
                    showNotification(`‚ùå „Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº: ${error.message}`);
                }
            };
            reader.readAsText(file, 'UTF-8');
            event.target.value = '';
        }
        function clearLearningData() {
            if (confirm(`ÂÖ®„Å¶„ÅÆÂ≠¶Áøí„Éá„Éº„ÇøÔºà${Object.keys(learningData).length}‰ª∂Ôºâ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
                learningData = {};
                saveLearningData();
                buildLearningDataRegex();
                updateLearningStats();
                showLearningData();
                showNotification('üóëÔ∏è ÂÖ®„Å¶„ÅÆÂ≠¶Áøí„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            }
        }
        function quickLearn() {
            if (!transcript.trim()) { showNotification('‚ùå Â≠¶ÁøíÂØæË±°„Å®„Å™„Çã„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì'); return; }
            const lastLine = transcript.trim().split('\n').pop();
            if (!lastLine) { showNotification('‚ùå ÊúÄÊñ∞„ÅÆË™çË≠ò„ÉÜ„Ç≠„Çπ„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'); return; }
            const correctedText = prompt(`üß† „ÇØ„Ç§„ÉÉ„ÇØÂ≠¶Áøí\n\nÊúÄÊñ∞„ÅÆË™çË≠ò„ÉÜ„Ç≠„Çπ„Éà:\n"${lastLine}"\n\nÊ≠£„Åó„ÅÑ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:`);
            if (correctedText && correctedText.trim() && correctedText.trim() !== lastLine) {
                learningData[lastLine] = correctedText.trim();
                saveLearningData();
                buildLearningDataRegex();
                transcript = transcript.replace(new RegExp(escapeRegex(lastLine) + '$'), correctedText.trim());
                transcriptHTML = escapeHtml(transcript).replace(/\n/g, '<br>');
                updateTranscriptDisplay();
                updateLearningStats();
                showNotification(`üß† „ÇØ„Ç§„ÉÉ„ÇØÂ≠¶ÁøíÂÆå‰∫Ü`);
            }
        }
        
        /**
         * @description ‰∫ãÂâç„Å´ÁîüÊàê„Åó„ÅüÊ≠£Ë¶èË°®Áèæ„Å®„Éû„ÉÉ„Éó„Çí‰Ωø„ÅÑ„ÄÅ„ÉÜ„Ç≠„Çπ„ÉàÂÜÖ„ÅÆÂçòË™û„ÇíÈ´òÈÄü„Å´Ëá™Âãï‰øÆÊ≠£„Åô„Çã
         * @param {string} text - ‰øÆÊ≠£ÂØæË±°„ÅÆ„ÉÜ„Ç≠„Çπ„Éà
         * @returns {string} ‰øÆÊ≠£Âæå„ÅÆ„ÉÜ„Ç≠„Çπ„Éà
         */
        function applyAutoCorrections(text) {
            if (!document.getElementById('autoCorrection').checked || !learningDataRegex) {
                return text;
            }
            
            let correctionsMade = 0;
            const correctedText = text.replace(learningDataRegex, (match) => {
                const replacement = learningDataMap.get(match.toLowerCase());
                if (replacement) {
                    correctionsMade++;
                    return replacement;
                }
                return match;
            });

            if (correctionsMade > 0) {
                autoCorrectionCount += correctionsMade;
                updateLearningStats();
            }
            return correctedText;
        }

        // === Êäò„Çä„Åü„Åü„ÅøÂà∂Âæ° ===
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId.replace('Section', 'Content'));
            const arrow = document.getElementById(sectionId.replace('Section', 'Arrow'));
            if (content && arrow) {
                content.classList.toggle('collapsed');
                content.classList.toggle('expanded');
                arrow.textContent = content.classList.contains('expanded') ? '‚ñ≤' : '‚ñº';
            }
        }

        // === Ë™çË®ºÊ©üËÉΩ ===
        function initAuthentication() {
            const authForm = document.getElementById('authForm');
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                if (username === AUTH_CONFIG.username && password === AUTH_CONFIG.password) {
                    localStorage.setItem('speech_auth', JSON.stringify({ authenticated: true, timestamp: Date.now() }));
                    showMainContent();
                } else {
                    const authError = document.getElementById('authError');
                    authError.textContent = '‚ùå „É¶„Éº„Ç∂„ÉºÂêç„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô';
                    authError.style.display = 'block';
                    setTimeout(() => { authError.style.display = 'none'; }, 3000);
                }
            });
            const savedAuth = localStorage.getItem('speech_auth');
            if (savedAuth && (Date.now() - JSON.parse(savedAuth).timestamp < 24 * 60 * 60 * 1000)) {
                showMainContent();
            }
        }
        function showMainContent() {
            document.getElementById('authOverlay').style.display = 'none';
            document.getElementById('mainContent').classList.add('authenticated');
            initializeMainFeatures();
        }

        // === Áµ±Ë®àÁÆ°ÁêÜ ===
        function loadStatistics() {
            const saved = localStorage.getItem('call_statistics');
            if (saved) {
                const stats = JSON.parse(saved);
                callCount = stats.callCount || 0;
                totalDuration = stats.totalDuration || 0;
            }
            updateStatistics();
        }
        function saveStatistics() {
            localStorage.setItem('call_statistics', JSON.stringify({ callCount, totalDuration }));
        }
        function updateStatistics() {
            document.getElementById('callCount').textContent = `${callCount}Âõû`;
            document.getElementById('currentDuration').textContent = formatDuration(currentCallDuration);
            document.getElementById('totalDuration').textContent = formatDuration(totalDuration);
            const avgDuration = callCount > 0 ? Math.floor(totalDuration / callCount) : 0;
            document.getElementById('avgDuration').textContent = formatDuration(avgDuration);
        }
        function startCallTimer() {
            currentCallStart = Date.now();
            callTimer = setInterval(() => {
                currentCallDuration = Math.floor((Date.now() - currentCallStart) / 1000);
                updateStatistics();
            }, 1000);
        }
        function stopCallTimer() {
            clearInterval(callTimer);
            if (currentCallStart) {
                totalDuration += Math.floor((Date.now() - currentCallStart) / 1000);
                currentCallDuration = 0;
                currentCallStart = null;
                saveStatistics();
                updateStatistics();
            }
        }

        // === Áí∞Â¢É„ÉÅ„Çß„ÉÉ„ÇØ„ÉªÈü≥Â£∞Ë™çË≠ò ===
        function checkEnvironment() {
            const isHTTPS = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
            updateStatus('httpsStatus', isHTTPS ? '‚úÖ OK' : '‚ùå NG', isHTTPS ? 'success' : 'error');
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const isSupported = SpeechRecognition && isHTTPS;
            updateStatus('speechStatus', isSupported ? '‚úÖ OK' : '‚ùå NG', isSupported ? 'success' : 'error');
            return isSupported;
        }
        function initSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return false;
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'ja-JP';
            recognition.onstart = () => {
                isRecording = true;
                callCount++;
                startCallTimer();
                updateUI();
                document.getElementById('transcriptArea').classList.add('listening');
            };
            
            recognition.onresult = (event) => {
                try {
                    let interim_transcript = '';
                    let final_transcript_chunk = '';
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        const chunk = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            final_transcript_chunk += chunk;
                        } else {
                            interim_transcript += chunk;
                        }
                    }

                    if (final_transcript_chunk) {
                        const corrected_chunk = applyAutoCorrections(final_transcript_chunk);
                        transcript += corrected_chunk + '\n';
                        transcriptHTML += escapeHtml(corrected_chunk + '\n').replace(/\n/g, '<br>');
                        log(`üìù Á¢∫ÂÆö„ÉÜ„Ç≠„Çπ„Éà: ${corrected_chunk}`);
                    }
                    updateTranscriptDisplay(interim_transcript);
                } catch (error) {
                    log(`Èü≥Â£∞Ë™çË≠òÁµêÊûúÂá¶ÁêÜ„Ç®„É©„Éº: ${error.message}`);
                }
            };

            recognition.onerror = (event) => {
                log(`‚ùå Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº: ${event.error}`);
                if (event.error === 'not-allowed') {
                    updateStatus('micStatus', '‚ùå ÊãíÂê¶', 'error');
                    stopRecording();
                }
            };

            recognition.onend = () => {
                if (!isRecording) {
                    log('üé§ Èå≤Èü≥„ÅØÂÅúÊ≠¢„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                    document.getElementById('transcriptArea').classList.remove('listening');
                    return;
                }

                log('üé§ Ë™çË≠ò„Çª„ÉÉ„Ç∑„Éß„É≥„Åå‰∏ÄÊó¶ÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇËá™Âãï„ÅßÂÜçÈñã„Åó„Åæ„Åô...');
                // ÂÆâÂÆöÊÄßÂêë‰∏ä„ÅÆ„Åü„ÇÅ„ÄÅrequestAnimationFrame„Çí‰ΩøÁî®„Åó„Å¶ÂÜçÈñã
                requestAnimationFrame(() => {
                    if (isRecording) {
                        try {
                            recognition.start();
                        } catch (e) {
                            log(`‚ùå Ë™çË≠ò„ÅÆËá™ÂãïÂÜçÈñã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${e.message}`);
                            stopRecording(); 
                        }
                    }
                });
            };
            return true;
        }

        // === UIÂà∂Âæ° ===
        function updateUI() {
            const summaryBtn = document.getElementById('summaryBtn');
            const hasText = isEditMode ? document.getElementById('transcriptTextarea').value.trim() : transcript.trim();

            document.getElementById('startBtn').disabled = isRecording;
            document.getElementById('stopBtn').disabled = !isRecording;
            document.getElementById('downloadBtn').disabled = !transcript.trim();
            if (summaryBtn) summaryBtn.disabled = !hasText || !apiKey;
            document.getElementById('endBtn').disabled = isRecording;
            document.getElementById('quickLearnBtn').disabled = !transcript.trim() || isRecording;
            const editToggleBtn = document.getElementById('editToggleBtn');
            editToggleBtn.textContent = isEditMode ? 'üëÅÔ∏è Ë°®Á§∫„É¢„Éº„Éâ' : '‚úèÔ∏è Á∑®ÈõÜ„É¢„Éº„Éâ';
            editToggleBtn.style.background = isEditMode ? '#dc3545' : '#17a2b8';
        }
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const area = document.getElementById('transcriptArea');
            const textarea = document.getElementById('transcriptTextarea');
            if (isEditMode) {
                textarea.value = transcript;
                area.style.display = 'none';
                textarea.style.display = 'block';
            } else {
                transcript = textarea.value;
                transcriptHTML = escapeHtml(transcript).replace(/\n/g, '<br>');
                updateTranscriptDisplay();
                area.style.display = 'block';
                textarea.style.display = 'none';
            }
            updateUI();
        }
        function updateTranscriptDisplay(interimText = '') {
            const area = document.getElementById('transcriptArea');
            const interimHTML = interimText ? `<span style="color:#999;">${escapeHtml(interimText)}</span>` : '';
            if (!transcript.trim() && !interimText.trim()) {
                area.classList.add('empty');
                area.innerHTML = 'Èü≥Â£∞Ë™çË≠òÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...';
            } else {
                area.classList.remove('empty');
                area.innerHTML = transcriptHTML + interimHTML;
            }
            area.scrollTop = area.scrollHeight;
        }

        // === Èå≤Èü≥Âà∂Âæ° ===
        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    stream.getTracks().forEach(track => track.stop());
                    updateStatus('micStatus', '‚úÖ Ë®±ÂèØ', 'success');
                    const timestamp = `\n[${new Date().toLocaleTimeString()}]\n`;
                    transcript += timestamp;
                    transcriptHTML += `<br>[${new Date().toLocaleTimeString()}]<br>`;
                    updateTranscriptDisplay();
                    recognition.start();
                })
                .catch(err => {
                    updateStatus('micStatus', '‚ùå ÊãíÂê¶', 'error');
                    showNotification('‚ùå „Éû„Ç§„ÇØ„Ç¢„ÇØ„Çª„Çπ„ÅåÂøÖË¶Å„Åß„Åô');
                });
        }
        function stopRecording() {
            isRecording = false;
            if (recognition) {
                recognition.stop();
            }
            stopCallTimer();
            updateUI();
        }

        // === „Éï„Ç°„Ç§„É´Êìç‰Ωú ===
        function downloadText() {
            if (!transcript.trim()) { showNotification('‚ùå „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åô„Çã„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì'); return; }
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            const filename = `Ë©¶È®ìÊ•≠Áïå„Çµ„Éù„Éº„ÉàÂØæÂøúË®òÈå≤_${timestamp}.txt`;
            const blob = new Blob([transcript], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // === APIÈñ¢ÈÄ£ ===
        function setupAPI() {
            const key = prompt('Gemini API„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', apiKey);
            if (key && key.trim().startsWith('AIzaSy')) {
                apiKey = key.trim();
                localStorage.setItem('gemini_api_key', apiKey);
                updateStatus('apiStatus', '‚úÖ Ë®≠ÂÆöÊ∏à', 'success');
                document.getElementById('testBtn').disabled = false;
                updateUI();
                showNotification('‚úÖ API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Åæ„Åó„Åü');
            } else if (key !== null) {
                showNotification('‚ùå ÁÑ°Âäπ„Å™API„Ç≠„ÉºÂΩ¢Âºè„Åß„Åô');
            }
        }
        async function testAPI() {
            if (!apiKey) { showNotification('‚ùå API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì'); return; }
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "Hello" }] }] })
                });
                if (response.ok) {
                    showNotification('‚úÖ APIÊé•Á∂öÊàêÂäüÔºÅ');
                } else {
                    showNotification(`‚ùå APIÊé•Á∂öÂ§±Êïó: ${response.status}`);
                }
            } catch (error) {
                showNotification(`‚ùå APIÊé•Á∂ö„Ç®„É©„Éº: ${error.message}`);
            }
        }

        // === Ë¶ÅÁ¥ÑÂÆüË°å („Ç∑„É≥„Ç∞„É´„É™„ÇØ„Ç®„Çπ„ÉàÁâà) ===
        async function generateSummary() {
            log('ü§ñ Ë¶ÅÁ¥ÑÈñãÂßã („Ç∑„É≥„Ç∞„É´„É™„ÇØ„Ç®„Çπ„Éà)');
            if (!apiKey) { showNotification('‚ùå API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì'); return; }

            const textSource = isEditMode ? document.getElementById('transcriptTextarea').value : transcript;
            const lines = textSource.split('\n');
            let lastTimestampIndex = -1;
            for (let i = lines.length - 1; i >= 0; i--) {
                if (/^\[\d{1,2}:\d{2}:\d{2}\]$/.test(lines[i].trim())) {
                    lastTimestampIndex = i;
                    break;
                }
            }
            const textToSummarize = (lastTimestampIndex !== -1 ? lines.slice(lastTimestampIndex).join('\n') : textSource).trim();
            
            if (!textToSummarize) {
                showNotification('‚ùå Ë¶ÅÁ¥Ñ„Åô„Çã„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            log(`üìù Ë¶ÅÁ¥ÑÂØæË±°„ÉÜ„Ç≠„Çπ„ÉàÔºà${textToSummarize.length}ÊñáÂ≠óÔºâ„ÇíÁâπÂÆö„Åó„Åæ„Åó„Åü„ÄÇ`);

            const summaryBtn = document.getElementById('summaryBtn');
            summaryBtn.textContent = 'ü§ñ Ë¶ÅÁ¥Ñ‰∏≠...';
            summaryBtn.disabled = true;
            
            const summaryPopup = document.getElementById('summaryPopup');
            const summaryContent = document.getElementById('summaryContent');
            const summaryPopupTitle = document.getElementById('summaryPopupTitle');
            summaryPopupTitle.textContent = 'ü§ñ Ë¶ÅÁ¥ÑÁîüÊàê‰∏≠...';
            summaryContent.innerHTML = '<div style="padding:20px; text-align:center;">Ë¶ÅÁ¥Ñ„ÇíÁîüÊàê„Åó„Å¶„ÅÑ„Åæ„Åô...</div>';
            summaryPopup.style.display = 'block';

            try {
                let basePrompt = (currentPrompt === 'custom') ? localStorage.getItem('custom_prompt') || prompts.default : prompts[currentPrompt];
                const fullPrompt = `${basePrompt}\n\n‰ª•‰∏ã„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíË¶ÅÁ¥Ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:\n\n---\n${textToSummarize}`;

                let finalSummary = '';
                const MAX_RETRIES = 3;
                for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: fullPrompt }] }] })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        finalSummary = data?.candidates?.[0]?.content?.parts?.[0]?.text || "Ë¶ÅÁ¥Ñ„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ";
                        break; // ÊàêÂäü„Åó„Åü„ÅÆ„Åß„É´„Éº„Éó„ÇíÊäú„Åë„Çã
                    } else if (response.status === 503 && attempt < MAX_RETRIES) {
                        log(`‚ö†Ô∏è API 503„Ç®„É©„Éº„ÄÇ${attempt * 2}ÁßíÂæå„Å´ÂÜçË©¶Ë°å„Åó„Åæ„Åô... (${attempt}/${MAX_RETRIES})`);
                        summaryContent.innerHTML = `<div style="padding:20px; text-align:center;">„Çµ„Éº„Éê„Éº„ÅåÊ∑∑„ÅøÂêà„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ<br>ÂÜçË©¶Ë°å‰∏≠ (${attempt}/${MAX_RETRIES})...</div>`;
                        await new Promise(resolve => setTimeout(resolve, 2000 * attempt));
                    } else {
                        throw new Error(`API„Ç®„É©„Éº: ${response.status}`);
                    }
                }
                
                if (finalSummary) {
                    summaryPopupTitle.textContent = 'ü§ñ ÂØæÂøúË®òÈå≤Ë¶ÅÁ¥ÑÁµêÊûú';
                    showSummaryPopup(finalSummary);
                } else {
                    throw new Error("API„Åã„Çâ„ÅÆÂøúÁ≠î„ÅåÁ©∫„Åã„ÄÅÂÖ®„Å¶„ÅÆ„É™„Éà„É©„Ç§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ");
                }

            } catch (error) {
                log(`‚ùå Ë¶ÅÁ¥Ñ„Ç®„É©„Éº: ${error.message}`);
                let errorMessage = `Ë¶ÅÁ¥Ñ„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ<br><small>${error.message}</small>`;
                if (error.message.includes('503')) {
                    errorMessage = `Ë¶ÅÁ¥Ñ„Çµ„Éº„Éê„Éº„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ<br><small>„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„Çâ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ(„Ç®„É©„Éº: 503)</small>`;
                }
                showNotification(`‚ùå Ë¶ÅÁ¥Ñ„Ç®„É©„Éº: ${error.message}`);
                summaryContent.innerHTML = `<div style="padding:20px; text-align:center; color:red;">${errorMessage}</div>`;
            } finally {
                summaryBtn.textContent = 'ü§ñ ÂØæÂøúË®òÈå≤Ë¶ÅÁ¥Ñ';
                updateUI();
            }
        }
        
        function showSummaryPopup(summary) {
            const summaryPopup = document.getElementById('summaryPopup');
            const summaryContent = document.getElementById('summaryContent');
            currentSummary = summary;
            summaryData = parseSummaryData(summary);
            summaryContent.innerHTML = formatSummaryWithCopy(summary);
            summaryPopup.style.display = 'block';
            addCopyEventListeners();
        }

        function closeSummaryPopup() {
            document.getElementById('summaryPopup').style.display = 'none';
        }

        function copySummary() {
            if (currentSummary) {
                const textArea = document.createElement("textarea");
                textArea.value = currentSummary;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('‚úÖ Ë¶ÅÁ¥Ñ„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
                } catch (err) {
                    showNotification('‚ùå „Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
                document.body.removeChild(textArea);
            }
        }

        function printSummary() {
            if (currentSummary) {
                const printWindow = window.open('', 'Print');
                printWindow.document.write(`<html><head><title>Ë¶ÅÁ¥Ñ</title></head><body>${currentSummary.replace(/\n/g, '<br>')}</body></html>`);
                printWindow.document.close();
                printWindow.print();
            }
        }
        
        // === „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö ===
        function setupEvents() {
            document.getElementById('startBtn').onclick = startRecording;
            document.getElementById('stopBtn').onclick = stopRecording;
            document.getElementById('downloadBtn').onclick = downloadText;
            document.getElementById('apiBtn').onclick = setupAPI;
            document.getElementById('testBtn').onclick = testAPI;
            document.getElementById('summaryBtn').onclick = generateSummary;
            document.getElementById('endBtn').onclick = endSession;
            document.getElementById('quickLearnBtn').onclick = quickLearn;
            document.getElementById('promptSelect').onchange = updatePromptPreview;
            document.addEventListener('keydown', (event) => {
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
                if (event.code === 'Space' && event.target === document.body) {
                    event.preventDefault();
                    isRecording ? stopRecording() : startRecording();
                }
                if (event.key === 'Escape') {
                    const summaryPopup = document.getElementById('summaryPopup');
                    if (summaryPopup && summaryPopup.style.display === 'block') {
                        closeSummaryPopup();
                    }
                }
            });
        }

        // === ÂàùÊúüÂåñ ===
        function initialize() {
            initAuthentication();
        }
        function initializeMainFeatures() {
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                apiKey = savedKey;
                updateStatus('apiStatus', '‚úÖ Ë®≠ÂÆöÊ∏à', 'success');
                document.getElementById('testBtn').disabled = false;
            }
            const savedPrompt = localStorage.getItem('selected_prompt');
            if (savedPrompt) {
                document.getElementById('promptSelect').value = savedPrompt;
                updatePromptPreview();
            }
            loadTemplates();
            loadLearningData();
            loadStatistics();
            if (checkEnvironment()) {
                initSpeechRecognition();
            }
            setupEvents();
            updateUI();
            toggleSection('statusSection');
            log('‚úÖ „É°„Ç§„É≥Ê©üËÉΩÂàùÊúüÂåñÂÆå‰∫Ü');
        }

        // DOMË™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„Å´ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
